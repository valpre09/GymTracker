// Load data
let workoutData = JSON.parse(localStorage.getItem('workoutData')) || {};
let sessionData = JSON.parse(localStorage.getItem('sessionData')) || [];

// DOM elements
const historySummary = document.getElementById('full-history-summary');
const historyTableBody = document.getElementById('full-history-table-body');
const progressChartCanvas = document.getElementById('full-progress-chart');
let progressChart = null;

// Display full history summary
function displayHistorySummary() {
    console.log('Displaying full history summary, workoutData:', workoutData, 'sessionData:', sessionData);
    historyTableBody.innerHTML = '';

    // Show individual exercise logs
    let allEntries = [];
    Object.keys(workoutData).forEach(workout => {
        workoutData[workout].forEach(entry => {
            allEntries.push({ workout, ...entry });
        });
    });
    allEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
    allEntries.forEach(entry => {
        const row = document.createElement('tr');
        const setsText = entry.sets.map((set, i) => `Set ${i + 1}: ${set.weight} kg x ${set.reps} reps`).join(', ');
        const totalMass = entry.sets.reduce((sum, set) => sum + set.weight * set.reps, 0);
        row.innerHTML = `
            <td>${entry.date}</td>
            <td>${entry.workout.charAt(0).toUpperCase() + entry.workout.slice(1)} Day</td>
            <td>${entry.exercise}</td>
            <td>${setsText}</td>
            <td>${totalMass}</td>
        `;
        historyTableBody.appendChild(row);
    });

    // Show session summaries
    if (sessionData.length > 0) {
        sessionData.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
        sessionData.forEach(session => {
            const row = document.createElement('tr');
            const duration = `${Math.floor(session.duration / 3600)}:${String(Math.floor((session.duration % 3600) / 60)).padStart(2, '0')}:${String(session.duration % 60).padStart(2, '0')}`;
            row.innerHTML = `
                <td>${session.startTime}</td>
                <td>${session.workout.charAt(0).toUpperCase() + session.workout.slice(1)} Day</td>
                <td>Full Session</td>
                <td>Duration: ${duration}</td>
                <td>${session.totalMass}</td>
            `;
            historyTableBody.appendChild(row);
        });
    }

    if (allEntries.length === 0 && sessionData.length === 0) {
        historyTableBody.innerHTML = '<tr><td colspan="5">No workout history available.</td></tr>';
    }
}

// Initialize history page
displayHistorySummary();
